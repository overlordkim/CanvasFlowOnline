<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptæå–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0D1117;
            color: #C9D1D9;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #30363D;
            border-radius: 8px;
        }
        .test-input {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            background: #21262D;
            border: 1px solid #30363D;
            border-radius: 6px;
            color: #C9D1D9;
            font-family: monospace;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: #161B22;
            border-radius: 6px;
            border: 1px solid #30363D;
        }
        .extract-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .extract-btn:hover {
            background: #2ea043;
        }
        code {
            background: #21262D;
            padding: 2px 6px;
            border-radius: 3px;
            color: #79C0FF;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Promptæå–åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ¡ˆä¾‹1ï¼šæ ‡å‡†æ ¼å¼</h3>
        <textarea class="test-input" id="test1">
## ğŸ“ **å®Œæ•´ç»˜ç”»æç¤ºè¯**

**English Prompt:**
```
A beautiful golden retriever puppy sitting in a sunny garden, photorealistic style, soft natural lighting, detailed fur texture, warm color palette, high quality, masterpiece, 8k resolution
```

**ä¸­æ–‡æè¿°ï¼š** ä¸€åªå¯çˆ±çš„é‡‘æ¯›çŠ¬å¹¼çŠ¬ååœ¨é˜³å…‰èŠ±å›­ä¸­ï¼Œé‡‡ç”¨å†™å®ä¸»ä¹‰é£æ ¼ï¼ŒæŸ”å’Œè‡ªç„¶å…‰å½±ï¼Œç»†è‡´çš„æ¯›å‘çº¹ç†ï¼Œæ¸©æš–è‰²è°ƒï¼Œé«˜è´¨é‡ä½œå“ã€‚

DRAWING_FINAL:å¼€å§‹ç»˜ç”»
        </textarea>
        <button class="extract-btn" onclick="testExtraction('test1', 'result1')">æå–Prompt</button>
        <div class="test-result" id="result1"></div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•æ¡ˆä¾‹2ï¼šç®€åŒ–æ ¼å¼</h3>
        <textarea class="test-input" id="test2">
æ ¹æ®æ‚¨çš„é€‰æ‹©ï¼Œæˆ‘ä¸ºæ‚¨ç”Ÿæˆäº†å®Œæ•´çš„ç»˜ç”»æç¤ºè¯ï¼š

English Prompt:
A mystical forest scene with ethereal lighting, fantasy art style, detailed foliage, magical atmosphere, vibrant colors, cinematic composition, high quality artwork

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ç»˜ç”»äº†ï¼

DRAWING_FINAL:å¼€å§‹åˆ›ä½œ
        </textarea>
        <button class="extract-btn" onclick="testExtraction('test2', 'result2')">æå–Prompt</button>
        <div class="test-result" id="result2"></div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•æ¡ˆä¾‹3ï¼šä»£ç å—æ ¼å¼</h3>
        <textarea class="test-input" id="test3">
å®Œæ•´çš„ç»˜ç”»æç¤ºè¯å¦‚ä¸‹ï¼š

```
Portrait of a young woman with flowing hair, impressionist painting style, soft brush strokes, warm lighting, artistic masterpiece, detailed facial features, beautiful composition
```

è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç»˜ç”»ã€‚
        </textarea>
        <button class="extract-btn" onclick="testExtraction('test3', 'result3')">æå–Prompt</button>
        <div class="test-result" id="result3"></div>
    </div>

    <script>
        // å¤åˆ¶CanvasFlowä¸­çš„promptæå–é€»è¾‘
        function extractPrompt(messageText) {
            let prompt = '';
            console.log('æ­£åœ¨åˆ†ææ¶ˆæ¯:', messageText);
            
            // æ–¹æ³•1ï¼šå¯»æ‰¾åŒ…å«English Promptçš„è¡Œ
            let englishPromptMatch = messageText.match(/English Prompt[ï¼š:\s]*[\n\r]*([\s\S]*?)(?=\n\n|\n[^\w]|$)/);
            if (englishPromptMatch) {
                prompt = englishPromptMatch[1].trim();
                console.log('é€šè¿‡English Promptæ ‡è¯†æå–åˆ°:', prompt);
                return prompt;
            }
            
            // æ–¹æ³•2ï¼šå¯»æ‰¾ä»£ç å—ä¸­çš„è‹±æ–‡å†…å®¹
            const codeMatches = messageText.match(/```([\s\S]*?)```/g);
            if (codeMatches) {
                for (let codeMatch of codeMatches) {
                    const codeText = codeMatch.replace(/```/g, '').trim();
                    // æ£€æŸ¥æ˜¯å¦ä¸»è¦æ˜¯è‹±æ–‡ä¸”é•¿åº¦åˆé€‚
                    const englishWordCount = (codeText.match(/\b[a-zA-Z]+\b/g) || []).length;
                    const totalWords = codeText.split(/\s+/).length;
                    
                    if (codeText.length > 30 && 
                        englishWordCount > totalWords * 0.7 && // 70%ä»¥ä¸Šæ˜¯è‹±æ–‡å•è¯
                        englishWordCount > 5) {
                        prompt = codeText;
                        console.log('é€šè¿‡ä»£ç å—æå–åˆ°:', prompt);
                        return prompt;
                    }
                }
            }
            
            // æ–¹æ³•3ï¼šç›´æ¥æœç´¢"English Prompt:"åçš„å†…å®¹
            const lines = messageText.split('\n');
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('English Prompt')) {
                    // è·å–åç»­è¡Œä½œä¸ºprompt
                    for (let j = i + 1; j < lines.length && j < i + 5; j++) {
                        const line = lines[j].trim();
                        if (line && line.length > 20 && /^[a-zA-Z]/.test(line)) {
                            prompt = line;
                            console.log('é€šè¿‡è¡Œæœç´¢æå–åˆ°:', prompt);
                            return prompt;
                        }
                    }
                }
            }
            
            return prompt;
        }

        function testExtraction(inputId, resultId) {
            const inputText = document.getElementById(inputId).value;
            const extractedPrompt = extractPrompt(inputText);
            const resultDiv = document.getElementById(resultId);
            
            if (extractedPrompt) {
                resultDiv.innerHTML = `
                    <h4>âœ… æå–æˆåŠŸ</h4>
                    <p><strong>æå–åˆ°çš„Prompt:</strong></p>
                    <code>${extractedPrompt}</code>
                `;
                resultDiv.style.border = '1px solid #238636';
            } else {
                resultDiv.innerHTML = `
                    <h4>âŒ æå–å¤±è´¥</h4>
                    <p>æ— æ³•ä»è¾“å…¥æ–‡æœ¬ä¸­æå–åˆ°æœ‰æ•ˆçš„è‹±æ–‡prompt</p>
                `;
                resultDiv.style.border = '1px solid #F85149';
            }
        }
    </script>
</body>
</html> 